<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mission List</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;900&family=Shippori+Mincho:wght@700&display=swap" rel="stylesheet">
    <link rel="manifest" href="/manifest.json">
    <script src="data/word_data.js"></script>
    <script src="js/app.js"></script>
    

    <style>
        body { 
            background: #0f172a; color: white; font-family: 'Montserrat', sans-serif; 
            opacity: 0; /* 初期状態は透明 */
            transition: opacity 0.3s ease-in-out; 
        }
        body.loaded {
            opacity: 1; /* 読み込み完了で表示 */
        }
        .jp-font { font-family: 'Shippori Mincho', serif; }
        
        /* カードのホバーアニメーション */
        .word-card:active { transform: scale(0.98); }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
    </style>
</head>
<body class="p-4 pb-20">

    <header class="sticky top-0 bg-[#0f172a]/95 backdrop-blur-md z-20 py-4 mb-4 border-b border-slate-700 flex justify-between items-center">
        <div class="flex items-center gap-4">
            <button onclick="goTo('index.html')" class="text-gray-400 hover:text-white transition">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
                </svg>
            </button>
            <h2 class="text-xl font-black tracking-widest text-cyan-400">MISSION LIST</h2>
        </div>
        <div class="text-xs text-gray-400 font-mono" id="total-progress">LOADING...</div>
    </header>

    <div id="list-container" class="space-y-3 max-w-2xl mx-auto">
        </div>

    <script>
        // エラーハンドリング: データが読み込めていない場合の対策
        if (typeof WORD_DATABASE === 'undefined') {
            alert("エラー: word_data.js が正しく読み込まれていません。コンソールを確認してください。");
        } else {
            renderList();
        }

        function renderList() {
            const container = document.getElementById('list-container');
            let masteredCount = 0;

            WORD_DATABASE.forEach(word => {
                const progress = getProgress(word.id);
                
                // クリアしたモードの数をカウント
                // GAME_MODESはapp.jsで定義されている必要があります
                let clearCount = 0;
                if (typeof GAME_MODES !== 'undefined') {
                    clearCount = GAME_MODES.filter(m => progress[m.id]).length;
                }

                const isMastered = clearCount === 5;
                if (isMastered) masteredCount++;

                // 進行度バーの幅
                const progressPercent = (clearCount / 5) * 100;
                
                // デザイン分岐
                let borderClass = 'border-slate-700';
                let bgClass = 'bg-slate-800';
                let textClass = 'text-white';

                if (isMastered) {
                    borderClass = 'border-cyan-500';
                    bgClass = 'bg-cyan-900/20';
                    textClass = 'text-cyan-300';
                } else if (clearCount > 0) {
                    borderClass = 'border-slate-600';
                    bgClass = 'bg-slate-700/50';
                }

                const div = document.createElement('div');
                div.className = `word-card relative p-4 rounded-xl border ${borderClass} ${bgClass} cursor-pointer transition-all overflow-hidden group`;
                
                // goTo関数を使って遷移（フェードアウト効果あり）
                div.onclick = () => {
                    goTo('cockpit.html', word.id);
                };

                div.innerHTML = `
                    <div class="flex justify-between items-center relative z-10">
                        <div>
                            <div class="text-xl font-bold tracking-wide ${textClass}">${word.word}</div>
                            <div class="text-sm text-gray-400 jp-font mt-1 line-clamp-1">${word.meaning_core}</div>
                        </div>
                        <div class="text-right pl-4">
                            <div class="text-[10px] font-mono text-gray-500 mb-1 tracking-wider">CLEAR</div>
                            <div class="text-lg font-bold font-mono ${isMastered ? 'text-cyan-400' : 'text-gray-600'}">
                                ${clearCount}<span class="text-xs text-gray-600">/5</span>
                            </div>
                        </div>
                    </div>
                    <div class="absolute bottom-0 left-0 h-1 bg-gradient-to-r from-cyan-500 to-purple-500 transition-all duration-1000" style="width: ${progressPercent}%"></div>
                `;
                container.appendChild(div);
            });

            // 全体進捗更新
            document.getElementById('total-progress').textContent = `${masteredCount} / ${WORD_DATABASE.length} MASTERED`;
        }
    </script>
</body>
</html>